from flask import Flask, request
import requests
import os

app = Flask(__name__)

# ุฏุฑุงูุช ุชูฺฉู ุงุฒ ูุชุบุฑ ูุญุท (ุจุฑุง ุงููุช โ ุฏุฑ Render ุชูุธู ูโุดูุฏ)
BOT_TOKEN = os.getenv("BOT_TOKEN")
if not BOT_TOKEN:
    raise ValueError("โ ูุทูุงู ูุชุบุฑ ูุญุท BOT_TOKEN ุฑุง ุฏุฑ Render ุชูุธู ฺฉูุฏ!")

API_URL = f"https://api.bale.ai/v1/bots/{BOT_TOKEN}/sendMessage"

# ูุชู ูพุงู ุฎูุดโุขูุฏฺฏู ุจุง ุงููุฌุ ููฺฉ ู ูุฑูุชโุจูุฏ Markdown
WELCOME_MESSAGE = """ุจุณู ุงููู ุงูุฑุญูู ุงูุฑุญู  
ุจู ุงุฑุชุด ููุนูุฏ (ุนุฌ) ุฎูุด ุขูุฏ ๐น

๐ฎ๐ท ูุฑุญูู ูุฎุณุช ุซุจุชโูุงู:  
ุจุฑุง ุซุจุชโูุงู ุฑุณู ููุท ฺฉุงููุ ููุฑุงู ุจุง ูุฏุงุฑฺฉ ููุช (ฺฉุงุฑุช ูู ู ุดูุงุณูุงูู) ุจู ูุญู ุซุจุชโูุงู ุงุฑุชุด ููุนูุฏ (ุนุฌ) ูุฑุงุฌุนู ฺฉู:

๐ ูุดุงู:  
ุชูุฑุงู - ุฎุงุจุงู ุดูุฏ ุฑุฌุงุฆ - ุจุงูุงุชุฑ ุงุฒ ุจุฒุฑฺฏุฑุงู ุขุฒุงุฏฺฏุงู - ูุณุฌุฏ ููโุงููู ุงุนุธู ุนุฌูโุงููู ุชุนุงู ูุฑุฌูโุงูุดุฑู  
ุณุงุฎุชูุงู ุฏุงุฑุงููุฑุขู โ ุทุจูู ููฺฉู

โธป

๐ก ูุฑุญูู ุฏูู:  
ุงุฒ ููู ุญุงูุง ุจู ฺฉุงูุงู ุฎุจุฑ ู ุขููุฒุด ุงุฑุชุด ููุนูุฏ (ุนุฌ) ุจูพููุฏ ุชุง ุฏุฑ ุฌุฑุงู ุขุฎุฑู ุขููุฒุดโูุงุ ุงุทูุงุนูโูุง ู ุจุฑูุงููโูุง ูุฑุงุฑ ุจฺฏุฑ:  
๐ [ูุฑุงุฑฺฏุงู ููุนูุฏ (ุนุฌ)](https://ble.ir/join/HgXmPphmfY)

โธป

๐๏ธ ูพุดุชุจุงู ู ุงุฑุชุจุงุท ุจุง ูุณุฆูู ูุฑู ุงูุณุงู:  
ุงฺฏุฑ ูพุฑุณุดุ ุงุจูุงู ุง ุฏุฑุฎูุงุณุช ุฏุงุดุชุ ูโุชูู ูุณุชููุงู ุจุง ูุณุฆูู ูพุดุชุจุงู ุฏุฑ ุงุฑุชุจุงุท ุจุงุด:  
๐ค [@poshtibaniarteshmowoud](https://ble.ir/poshtibaniarteshmowoud)

ุง ุตุงุญุจโุงูุฒูุงู ุงุฏุฑฺฉู. ๐คฒ"""

@app.route('/')
def home():
    """ุจุฑุง ุจุฑุฑุณ ุณูุงูุช ู ูุนุงู ูฺฏู ุฏุงุดุชู ุชูุณุท UptimeRobot"""
    return "ุฑุจุงุช ุงุฑุชุด ููุนูุฏ (ุนุฌ) ูุนุงู ุงุณุช โ", 200

@app.route(f'/{BOT_TOKEN}', methods=['POST'])
def webhook():
    """ุฏุฑุงูุช ูพุงูโูุง ุงุฒ ุจูู ู ูพุงุณุฎ ุจู /start"""
    data = request.get_json()
    
    # ุงฺฏุฑ ุฏุงุฏูโุง ุฏุฑุงูุช ูุดุฏู ุง ูพุงู ูุจุงุดุฏุ ูุงุฏุฏู ุจฺฏุฑ
    if not data or 'message' not in data:
        return "OK", 200

    message = data['message']
    chat_id = message['chat']['id']
    text = message.get('text', '')

    # ููุท ุจู ุฏุณุชูุฑ /start ูพุงุณุฎ ุจุฏู
    if text == '/start':
        payload = {
            "chat_id": chat_id,
            "text": WELCOME_MESSAGE,
            "parse_mode": "Markdown"  # ุจุฑุง ูุนุงู ฺฉุฑุฏู ููฺฉโูุง ู ูุฑูุชโุจูุฏ
        }
        requests.post(API_URL, json=payload)

    return "OK", 200

if __name__ == '__main__':
    app.run(debug=True)
